{% load menu_tags %}

{# TODO: GL-36/GL-44: Implement dropdown to support more than one tier #}
{# NOTE: This template content is copied from a third-party plugin that we do not use nor need #}
{# SEE: https://github.com/jrief/djangocms-bootstrap/blob/aa74994/cms_bootstrap/templates/bootstrap4/menu/navbar.html #}
{% spaceless %}
{% for child in children %}
{% with child_url=child.attr.redirect_url|default:child.get_absolute_url child_title=child.get_menu_title|safe %}
<li class="nav-item{% if child.selected or child.ancestor or request.get_full_path == child_url %} active{% endif %}{% if child.children %} dropdown{% endif %}">
	{% if child.is_leaf_node %}
	<a class="nav-link" href="{{ child_url }}">
		{{ child_title }}
		<span class="sr-only">(current)</span>
	</a>
	{% else %}
  <span class="nav-link">
    <a href="{{ child_url }}">
      {{ child_title }}
    </a>
    <a
      href=""
      class="dropdown-toggle dropdown-toggle-split"
      data-toggle="dropdown"
      aria-haspopup="true"
      aria-expanded="false">
      <span class="sr-only">Toggle Dropdown</span>
    </a>
    <div class="dropdown-menu" role="menu" aria-labelledby="navbarDropdown">
      {% comment %}
      Bootsrap4 does not support submenues, so levels > 1 can't be handled be the main_menu tag and therfore
      recursion has been dropped intentionally. Read https://github.com/twbs/bootstrap/pull/6342 for details.
      {% endcomment %}
      {% for grandchild in child.children %}
      {% with grandchild_url=grandchild.attr.redirect_url|default:grandchild.get_absolute_url grandchild_title=grandchild.get_menu_title|safe %}
      <a class="dropdown-item{% if grandchild.selected %} active{% endif %}" href="{{ grandchild_url }}" role="menuitem">
        {{ grandchild.get_menu_title|safe }}
      </a>
      {% endwith %}
      {% endfor %}
  </span>
	{% endif %}
</li>
{% endwith %}
{% endfor %}
{% endspaceless %}
